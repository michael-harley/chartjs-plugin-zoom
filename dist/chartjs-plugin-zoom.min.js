/*!
 * @license
 * chartjs-plugin-zoom
 * http://chartjs.org/
 * Version: 0.7.7
 *
 * Copyright 2021 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-plugin-zoom/blob/master/LICENSE.md
 */
!function(o,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("chart.js/helpers"),require("hammerjs")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers","hammerjs"],e):(o="undefined"!=typeof globalThis?globalThis:o||self).ChartZoom=e(o.Chart,o.Chart.helpers,o.Hammer)}(this,(function(o,e,n){"use strict";function t(o){return o&&"object"==typeof o&&"default"in o?o:{default:o}}var a=t(n),i={},r=i.zoomFunctions=i.zoomFunctions||{},l=i.panFunctions=i.panFunctions||{};function m(o,n){var t={};void 0!==o.options.pan&&(t.pan=o.options.pan),void 0!==o.options.zoom&&(t.zoom=o.options.zoom);var a=o.$zoom;n=a._options=e.merge({},[n,t]);var i=a._node,r=n.zoom&&n.zoom.enabled,l=n.zoom.drag;r&&!l?i.addEventListener("wheel",a._wheelHandler):i.removeEventListener("wheel",a._wheelHandler),r&&l?(i.addEventListener("mousedown",a._mouseDownHandler),i.ownerDocument.addEventListener("mouseup",a._mouseUpHandler)):(i.removeEventListener("mousedown",a._mouseDownHandler),i.removeEventListener("mousemove",a._mouseMoveHandler),i.ownerDocument.removeEventListener("mouseup",a._mouseUpHandler))}function s(o){var n=o.$zoom._originalOptions;e.each(o.scales,(function(o){n[o.id]||(n[o.id]=e.clone(o.options))})),e.each(n,(function(e,t){o.scales[t]||delete n[t]}))}function u(o,e,n){return void 0===o||("string"==typeof o?-1!==o.indexOf(e):"function"==typeof o&&-1!==o({chart:n}).indexOf(e))}function c(o,n){if(o.scaleAxes&&o.rangeMax&&!e.isNullOrUndef(o.rangeMax[o.scaleAxes])){var t=o.rangeMax[o.scaleAxes];n>t&&(n=t)}return n}function d(o,n){if(o.scaleAxes&&o.rangeMin&&!e.isNullOrUndef(o.rangeMin[o.scaleAxes])){var t=o.rangeMin[o.scaleAxes];n<t&&(n=t)}return n}function p(o,e,n,t){var a=o.max-o.min,i=a*(e-1),r=o.isHorizontal()?n.x:n.y,l=(o.getValueForPixel(r)-o.min)/a,m=i*l,s=i*(1-l);o.options.min=d(t,o.min+m),o.options.max=c(t,o.max-s)}function f(o,e,n,t){var a=r[o.type];a&&a(o,e,n,t)}function v(o,n,t,a,i,r){var l=o.chartArea;a||(a={x:(l.left+l.right)/2,y:(l.top+l.bottom)/2});var m=o.$zoom._options.zoom;if(m.enabled){s(o);var c,d="function"==typeof m.mode?m.mode({chart:o}):m.mode;c="xy"===d&&void 0!==i?i:"xy",e.each(o.scales,(function(e){e.isHorizontal()&&u(d,"x",o)&&u(c,"x",o)?(m.scaleAxes="x",f(e,n,a,m)):!e.isHorizontal()&&u(d,"y",o)&&u(c,"y",o)&&(m.scaleAxes="y",f(e,t,a,m))})),r?(o.options.animation.zoom||(o.options.animation.zoom={duration:r,easing:"easeOutQuad"}),o.update("zoom")):o.update("none"),"function"==typeof m.onZoom&&m.onZoom({chart:o})}}function h(o,n,t){var a,i=o.options,r=o.min,l=o.max,m=o.getValueForPixel(o.getPixelForValue(r)-n),s=o.getValueForPixel(o.getPixelForValue(l)-n),u=m,c=s;t.scaleAxes&&t.rangeMin&&!e.isNullOrUndef(t.rangeMin[t.scaleAxes])&&(u=t.rangeMin[t.scaleAxes]),t.scaleAxes&&t.rangeMax&&!e.isNullOrUndef(t.rangeMax[t.scaleAxes])&&(c=t.rangeMax[t.scaleAxes]),m>=u&&s<=c?(i.min=m,i.max=s):m<u?(a=r-u,i.min=u,i.max=l-a):s>c&&(a=c-l,i.max=c,i.min=r+a)}function z(o,e,n){var t=l[o.type];t&&t(o,e,n)}i.zoomFunctions.category=function(o,e,n,t){var a=o.chart.data.labels,r=o.min,l=a.length-1,m=o.max,s=t.sensitivity,u=o.isHorizontal()?o.left+o.width/2:o.top+o.height/2,p=o.isHorizontal()?n.x:n.y,f=m-r,v=Math.abs(1-e);i.zoomCumulativeDelta=e>1?i.zoomCumulativeDelta+1:i.zoomCumulativeDelta-1,Math.abs(i.zoomCumulativeDelta)>s&&(i.zoomCumulativeDelta<0?(p>=u?r<=0?m=Math.min(l,Math.floor(m+f*v)):r=Math.max(0,Math.floor(r-f*v)):p<u&&(m>=l?r=Math.max(0,Math.floor(r-f*v)):m=Math.min(l,Math.floor(m+f*v))),i.zoomCumulativeDelta=0):i.zoomCumulativeDelta>0&&(p>=u?r=r<m?Math.min(m,Math.floor(r+f*v)):r:p<u&&(m=m>r?Math.max(r,Math.floor(m-f*v)):m),i.zoomCumulativeDelta=0),o.options.min=d(t,a[r]),o.options.max=c(t,a[m]))},i.zoomFunctions.time=p,i.zoomFunctions.linear=p,i.zoomFunctions.logarithmic=p,i.panFunctions.category=function(o,e,n){var t,a=o.chart.data.labels,r=a.length-1,l=Math.max(o.ticks.length,1),m=n.speed,s=o.min,u=Math.round(o.width/(l*m));i.panCumulativeDelta+=e,s=i.panCumulativeDelta>u?Math.max(0,s-1):i.panCumulativeDelta<-u?Math.min(r-l+1,s+1):s,i.panCumulativeDelta=s!==o.min?0:i.panCumulativeDelta,t=Math.min(r,s+l-1),o.options.min=d(n,a[s]),o.options.max=c(n,a[t])},i.panFunctions.time=h,i.panFunctions.linear=h,i.panFunctions.logarithmic=h,i.panCumulativeDelta=0,i.zoomCumulativeDelta=0;var g={id:"zoom",defaults:{pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1}},start:function(o,n,t){o.$zoom={_originalOptions:{}};var r=o.$zoom._node=o.ctx.canvas;m(o,t);var l=o.$zoom._options,c=l.pan&&l.pan.threshold;o.$zoom._mouseDownHandler=function(e){r.addEventListener("mousemove",o.$zoom._mouseMoveHandler),o.$zoom._dragZoomStart=e},o.$zoom._mouseMoveHandler=function(e){o.$zoom._dragZoomStart&&(o.$zoom._dragZoomEnd=e,o.update("none"))},o.$zoom._mouseUpHandler=function(e){if(o.$zoom._dragZoomStart){r.removeEventListener("mousemove",o.$zoom._mouseMoveHandler);var n=o.$zoom._dragZoomStart,t=n.target.getBoundingClientRect().left,a=Math.min(n.clientX,e.clientX)-t,i=Math.max(n.clientX,e.clientX)-t,m=n.target.getBoundingClientRect().top,s=Math.min(n.clientY,e.clientY)-m,c=i-a,d=Math.max(n.clientY,e.clientY)-m-s;o.$zoom._dragZoomStart=null,o.$zoom._dragZoomEnd=null;var p=l.zoom&&l.zoom.threshold||0;if(!(c<=p&&d<=p)){var f=o.chartArea,h=o.$zoom._options.zoom,z=f.right-f.left,g=u(h.mode,"x",o)&&c?1+(z-c)/z:1,x=f.bottom-f.top,_=u(h.mode,"y",o);v(o,g,_&&d?1+(x-d)/x:1,{x:(a-f.left)/(1-c/z)+f.left,y:(s-f.top)/(1-d/x)+f.top},void 0,h.drag.animationDuration),"function"==typeof h.onZoomComplete&&h.onZoomComplete({chart:o})}}};var d=null;if(o.$zoom._wheelHandler=function(e){if(e.cancelable&&e.preventDefault(),void 0!==e.deltaY){var n=e.target.getBoundingClientRect(),t={x:e.clientX-n.left,y:e.clientY-n.top},a=o.$zoom._options.zoom,i=a.speed;e.deltaY>=0&&(i=-i),v(o,1+i,1+i,t),clearTimeout(d),d=setTimeout((function(){"function"==typeof a.onZoomComplete&&a.onZoomComplete({chart:o})}),250)}},a.default){var p,f=new a.default.Manager(r);f.add(new a.default.Pinch),f.add(new a.default.Pan({threshold:c}));var h=function(e){var n=1/p*e.scale,t=e.target.getBoundingClientRect(),a={x:e.center.x-t.left,y:e.center.y-t.top},i=Math.abs(e.pointers[0].clientX-e.pointers[1].clientX),r=Math.abs(e.pointers[0].clientY-e.pointers[1].clientY),l=i/r;v(o,n,n,a,l>.3&&l<1.7?"xy":i>r?"x":"y");var m=o.$zoom._options.zoom;"function"==typeof m.onZoom&&m.onZoom({chart:o}),p=e.scale};f.on("pinchstart",(function(){p=1})),f.on("pinch",h),f.on("pinchend",(function(e){h(e),p=null,i.zoomCumulativeDelta=0;var n=o.$zoom._options.zoom;"function"==typeof n.onZoomComplete&&n.onZoomComplete({chart:o})}));var g=null,x=null,_=!1,y=function(n){if(null!==g&&null!==x){_=!0;var t=n.deltaX-g,a=n.deltaY-x;g=n.deltaX,x=n.deltaY,function(o,n,t){s(o);var a=o.$zoom._options.pan;if(a.enabled){var i="function"==typeof a.mode?a.mode({chart:o}):a.mode;e.each(o.scales,(function(e){e.isHorizontal()&&u(i,"x",o)&&0!==n?(a.scaleAxes="x",z(e,n,a)):!e.isHorizontal()&&u(i,"y",o)&&0!==t&&(a.scaleAxes="y",z(e,t,a))})),o.update("none"),"function"==typeof a.onPan&&a.onPan({chart:o})}}(o,t,a)}};f.on("panstart",(function(o){g=0,x=0,y(o)})),f.on("panmove",y),f.on("panend",(function(){g=null,x=null,i.panCumulativeDelta=0,setTimeout((function(){_=!1}),500);var e=o.$zoom._options.pan;"function"==typeof e.onPanComplete&&e.onPanComplete({chart:o})})),o.$zoom._ghostClickHandler=function(o){_&&o.cancelable&&(o.stopImmediatePropagation(),o.preventDefault())},r.addEventListener("click",o.$zoom._ghostClickHandler),o._mc=f}o.resetZoom=function(){s(o);var n=o.$zoom._originalOptions;e.each(o.scales,(function(o){var e=o.options;n[o.id]?(e.min=n[o.id].min,e.max=n[o.id].max):(delete e.min,delete e.max)})),o.update()}},beforeUpdate:function(o,e,n){m(o,n)},beforeDatasetsDraw:function(o){var e=o.ctx;if(o.$zoom._dragZoomEnd){var n=function(o){for(var e=o.scales,n=Object.keys(e),t=0;t<n.length;t++){var a=e[n[t]];if(a.isHorizontal())return a}}(o),t=function(o){for(var e=o.scales,n=Object.keys(e),t=0;t<n.length;t++){var a=e[n[t]];if(!a.isHorizontal())return a}}(o),a=o.$zoom._dragZoomStart,i=o.$zoom._dragZoomEnd,r=n.left,l=n.right,m=t.top,s=t.bottom;if(u(o.$zoom._options.zoom.mode,"x",o)){var c=a.target.getBoundingClientRect().left;r=Math.min(a.clientX,i.clientX)-c,l=Math.max(a.clientX,i.clientX)-c}if(u(o.$zoom._options.zoom.mode,"y",o)){var d=a.target.getBoundingClientRect().top;m=Math.min(a.clientY,i.clientY)-d,s=Math.max(a.clientY,i.clientY)-d}var p=l-r,f=s-m,v=o.$zoom._options.zoom.drag;e.save(),e.beginPath(),e.fillStyle=v.backgroundColor||"rgba(225,225,225,0.3)",e.fillRect(r,m,p,f),v.borderWidth>0&&(e.lineWidth=v.borderWidth,e.strokeStyle=v.borderColor||"rgba(225,225,225)",e.strokeRect(r,m,p,f)),e.restore()}},stop:function(o){if(o.$zoom){var e=o.$zoom,n=e._node;n.removeEventListener("mousedown",e._mouseDownHandler),n.removeEventListener("mousemove",e._mouseMoveHandler),n.ownerDocument.removeEventListener("mouseup",e._mouseUpHandler),n.removeEventListener("wheel",e._wheelHandler),n.removeEventListener("click",e._ghostClickHandler),delete o.$zoom;var t=o._mc;t&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"),t.destroy())}}};return o.Chart.register(g),g}));
